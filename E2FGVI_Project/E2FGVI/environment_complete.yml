name: e2fgvi
channels:
  - pytorch
  - conda-forge
  - defaults

dependencies:
  # Python version
  - python=3.12.4
  
  # Build tools
  - setuptools>=71.1.0
  - pip>=25.0
  - wheel>=0.43.0
  
  # System libraries (conda channel)
  - vc=14.3
  - libffi
  
  # PyTorch Stack (GPU-enabled) - CRITICAL
  # Install these from PyTorch channel (specified above)
  - pytorch::pytorch::2.6.0=py3.12_cuda12.4_cudnn9_0
  - pytorch::pytorch-cuda=12.4
  - pytorch::torchvision::0.21.0=py312_cu124__0
  - pytorch::torchaudio::2.6.0=py312_cu124__0
  
  # Core dependencies via pip (requires post-install)
  - pip
  
  - pip:
    # === MMCV (Video Inpainting) ===
    - mmcv==1.7.2
    
    # === Computer Vision & Image Processing ===
    - opencv-python==4.10.0.84
    - Pillow==10.4.0
    - scikit-image==0.24.0
    - imageio==2.34.2
    
    # === Numerics & Data ===
    - numpy==1.26.4
    - scipy==1.14.0
    - scikit-learn==1.5.1
    - pandas==2.2.2
    
    # === Config & Utility ===
    - addict==2.4.0
    - PyYAML==6.0.1
    - regex==2024.7.24
    
    # === Monitoring & Visualization ===
    - tqdm==4.66.4
    - matplotlib==3.9.1
    - tensorboard==2.17.0
    
    # === Development Tools ===
    - yapf==0.43.0
    - Jupyter==1.1.1
    - ipython==8.32.0
    - jupyter-client==8.6.3
    - jupyterlab==4.3.5
    
    # === Optional Dependencies ===
    - einops==0.8.0
    - timm==0.9.16

# Environment metadata
variables:
  CUDA_VERSION: "12.4"
  TORCH_VERSION: "2.6.0"
  MMCV_MODE: "pure-python"
  GPU_MODEL: "NVIDIA RTX 4070 Laptop"

# Installation instructions
# 
# 1. Create environment from this file:
#    conda env create -f environment_complete.yml
#
# 2. Activate environment:
#    conda activate e2fgvi
#
# 3. Verify GPU support:
#    python check_cuda.py
#
# 4. Run small-scale training to validate:
#    python train.py --config configs/train_e2fgvi_small.json
#
# === Key Notes ===
# ✅ Python 3.12.4 + PyTorch 2.6.0 + CUDA 12.4
# ✅ GPU-enabled (RTX 4070, RTX 4090, RTX A6000 compatible)
# ✅ Deformable conv compatibility layer: core/modules/deform_conv_compat.py
# ✅ Successfully tested: 3 videos × 74 iterations training
#
# === Environment Variables ===
# CUDA_VERSION=12.4
# TORCH_VERSION=2.6.0
# MMCV_MODE=pure-python (fallback, no native ops)
#
# === Troubleshooting ===
# If torch.cuda.is_available() returns False:
#   - Check: nvidia-smi
#   - Reinstall PyTorch: pip install torch==2.6.0+cu124 --index-url https://download.pytorch.org/whl/cu124
#
# If deform_conv errors occur:
#   - Already handled by compatibility layer (core/modules/deform_conv_compat.py)
#   - Check logs for: "[WARNING] Using deformable convolution compatibility layer"
#
# If memory errors (OOM):
#   - Reduce batch_size in config (default: 2)
#   - Use smaller frame resolution in configs
