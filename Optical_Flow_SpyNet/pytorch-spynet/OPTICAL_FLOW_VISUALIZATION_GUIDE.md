# 光流估计可视化说明

## 什么是光流？

光流（Optical Flow）是描述视频中相邻帧之间像素运动的技术。在我们的可视化中：

- **颜色**表示运动的**方向**
- **亮度**表示运动的**速度**（越亮运动越快）

## 颜色说明（色轮）

在我们的可视化中使用 HSV 色轮来表示方向：

```
                  ↑ UP (黄色)
                  |
LEFT (蓝色) ← —— 中心 —— → RIGHT (红色)
                  |
                  ↓ DOWN (绿色)
```

### 具体颜色含义：

- **红色 (Red)**: 像素向**右**移动
- **绿色 (Green)**: 像素向**下**移动  
- **蓝色 (Blue)**: 像素向**左**移动
- **黄色 (Yellow)**: 像素向**右下**移动（红+绿）
- **品红 (Magenta)**: 像素向**右上**移动（红+蓝）
- **青色 (Cyan)**: 像素向**左下**移动（蓝+绿）

## 亮度含义

- **高亮度**: 运动速度快
- **低亮度**: 运动速度慢
- **黑色**: 基本没有运动（光流为零）

## 输出文件说明

### .flo 文件
- 原始光流数据，包含 X 和 Y 方向的运动向量
- 文件格式：`output_frames_XXXX.flo`（每对连续帧生成一个）

### 可视化图像 (PNG)
- `optical_flow_visualization.png`: 所有光流帧的拼接图，包含色轮图例
- 每个小图代表一对连续帧之间的光流

### 视频 (MP4)
- `optical_flow_visualization.mp4`: 光流序列的视频
- 可以直观看到运动的连贯性

## 使用示例

### 处理单个帧序列

```bash
conda activate opticalflow_estimation_visualization
python run.py --frames-package <帧文件夹> --out <输出前缀> --output-dir <输出目录>
```

### 可视化结果

```bash
python visualize_optical_flow.py <光流文件前缀> <输出目录>
```

## 示例输出解释

如果你看到：
- **大片绿色区域**: 该区域的物体在向下运动
- **混合的彩色区域**: 该区域有复杂的运动
- **黑色区域**: 该区域基本静止或运动很慢
- **明亮的颜色**: 快速运动
- **暗淡的颜色**: 缓慢运动

## 注意事项

1. 光流只能估计平面运动，对于3D运动或遮挡可能不准确
2. 在高速运动或快速变化的场景中准确度会降低
3. 模型在1024x416分辨率下训练效果最好，其他分辨率效果可能有所下降
4. CPU 计算速度较慢，GPU 会快很多
